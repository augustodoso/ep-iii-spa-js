import{$ as t,$$ as e}from"../utils/dom.js";import{storage as r}from"../storage.js";import{isRequired as a,isEmail as o,minLen as n,equals as i,minAge as s,uniqueEmail as m,runValidators as c}from"../validators.js";export function initFormCadastro(d){const l=t("#form-cadastro",d);if(!l)return;const u=t("#nome",l),f=t("#email",l),v=t("#nasc",l),p=t("#perfil",l),b=t("#senha",l),g=t("#confirm",l),h=t("#limpar",l),C=t("#form-status",l);C.setAttribute("role","status"),C.setAttribute("aria-live","polite");const x={nome:[a],email:[a,o,m(r.emailExists)],nasc:[s(16)],perfil:[a],senha:[a,n(8)],confirm:[i(()=>b.value,"a senha")]};function A(t,e){const r=d.querySelector(`[data-error-for="${t.id}"]`);r&&(r.textContent=e||"",r.id=`${t.id}-error`),e?(t.setAttribute("aria-invalid","true"),t.setAttribute("aria-describedby",`${t.id}-error`)):(t.removeAttribute("aria-invalid"),t.removeAttribute("aria-describedby"))}function D(t){const e=x[t.name]||[],r=c(t.value,e);return A(t,r),!r}["input","change","blur"].forEach(t=>{l.addEventListener(t,t=>{const e=t.target;e.name in x&&D(e),e===b&&g.value&&D(g)})}),l.addEventListener("submit",t=>{t.preventDefault();const a=[u,f,v,p,b,g].map(t=>({inp:t,ok:D(t)}));if(a.every(t=>t.ok)&&"mentor"===p.value){const t=new Date(v.value),e=new Date;e.getFullYear()-t.getFullYear()-(e.getMonth()<t.getMonth()||e.getMonth()===t.getMonth()&&e.getDate()<t.getDate()?1:0)<18&&(A(v,"Para perfil Mentor, idade mínima é 18 anos."),a.find(t=>t.inp===v).ok=!1)}if(!a.every(t=>t.ok)){const t=a.find(t=>!t.ok)?.inp;return t?.focus(),void(C.textContent="Há campos com erro. Corrija-os para continuar.")}const o={id:crypto.randomUUID(),nome:u.value.trim(),email:f.value.trim(),nasc:v.value,perfil:p.value,createdAt:(new Date).toISOString()};r.add(o),C.textContent="Cadastro realizado com sucesso!",l.reset(),e("#form-cadastro [data-error-for]").forEach(t=>t.textContent="")}),h.addEventListener("click",()=>{l.reset(),C.textContent="Campos limpos.",e("#form-cadastro [data-error-for]").forEach(t=>t.textContent="")})}